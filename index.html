<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Input Barang</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1a1a1a;
            color: #e0e0e0;
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        input, button {
            padding: 5px;
            background-color: #333;
            color: #e0e0e0;
            border: 1px solid #555;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #555;
            padding: 8px;
            text-align: left;
        }
        .delete-btn {
            background-color: #8b0000;
            color: white;
            border: none;
            padding: 5px 10px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Sistem Input Barang</h1>
    </div>

    <h1>Input Barang</h1>
    <form id="barangForm">
        <input type="text" id="namaBarang" placeholder="Nama Barang" required>
        <input type="number" id="hargaBarang" placeholder="Harga Barang (Rp)" required>
        <button type="submit">Tambah Barang</button>
    </form>

    <table id="daftarBarang">
        <thead>
            <tr>
                <th>Nama Barang</th>
                <th>Harga</th>
                <th>Aksi</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <h2>Total Harga: <span id="totalHarga">Rp 0</span></h2>

    <script>
        // **Konfigurasi Firebase** (Sudah diperbaiki)
        const firebaseConfig = {
            apiKey: "AIzaSyASnRnvKYvIZC7F-p7zcE8F_jD1Or-Bhqk",
            authDomain: "input-barang-eef3c.firebaseapp.com",
            projectId: "input-barang-eef3c",
            storageBucket: "input-barang-eef3c.appspot.com",
            messagingSenderId: "144968865387",
            appId: "1:144968865387:web:2ebb2533d52ec07d0b432e",
            measurementId: "G-YP6N1CTE1Q"
        };

        // **Inisialisasi Firebase**
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const form = document.getElementById('barangForm');
        const tableBody = document.getElementById('daftarBarang').getElementsByTagName('tbody')[0];
        const totalHargaSpan = document.getElementById('totalHarga');
        let totalHarga = 0;

        // **Menampilkan Data dari Firestore**
        function loadData() {
            db.collection("barang").onSnapshot(snapshot => {
                tableBody.innerHTML = "";
                totalHarga = 0;
                snapshot.forEach(doc => {
                    const data = doc.data();
                    tambahBarang(doc.id, data.nama, data.harga);
                });
            });
        }

        // **Menambahkan Barang**
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            const nama = document.getElementById('namaBarang').value;
            const harga = parseInt(document.getElementById('hargaBarang').value);

            if (!nama || isNaN(harga)) {
                alert("Nama dan harga barang harus diisi dengan benar!");
                return;
            }

            db.collection("barang").add({ nama, harga })
                .then(() => {
                    form.reset();
                })
                .catch(error => console.error("Error: ", error));
        });

        function tambahBarang(id, nama, harga) {
            const row = tableBody.insertRow();
            row.innerHTML = `
                <td>${nama}</td>
                <td>${formatRupiah(harga)}</td>
                <td><button class="delete-btn" onclick="hapusBarang('${id}')">Hapus</button></td>
            `;
            totalHarga += harga;
            updateTotalHarga();
        }

        function hapusBarang(id) {
            db.collection("barang").doc(id).delete();
        }

        function updateTotalHarga() {
            totalHargaSpan.textContent = formatRupiah(totalHarga);
        }

        function formatRupiah(angka) {
            return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR' }).format(angka);
        }

        loadData();
    </script>
</body>
</html>